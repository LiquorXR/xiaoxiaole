# å¼€å¿ƒæ¶ˆæ¶ˆä¹

è¿™æ˜¯ä¸€ä¸ªåŸºäº Web æŠ€æœ¯å¼€å‘çš„ç»å…¸ä¸‰æ¶ˆæ¸¸æˆï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ¸¸æˆè¿›åº¦ä¿å­˜ä»¥åŠå…¨çƒæ’è¡Œæ¦œåŠŸèƒ½ã€‚

## é¡¹ç›®ç®€ä»‹

è¯¥é¡¹ç›®é‡‡ç”¨åŸç”Ÿ JavaScript å¼€å‘å‰ç«¯é€»è¾‘ï¼Œç»“åˆ Cloudflare Workers (Functions) å¤„ç†åç«¯é€»è¾‘ï¼Œå¹¶ä½¿ç”¨ Cloudflare D1 ä½œä¸ºæŒä¹…åŒ–æ•°æ®åº“ã€‚æ¸¸æˆå…·æœ‰å¹³æ»‘çš„åŠ¨ç”»æ•ˆæœã€åŠ¨æ€éš¾åº¦è°ƒæ•´ä»¥åŠç‰¹æ®Šçš„â€œè¶…çº§æ–¹å—â€æ¶ˆé™¤æœºåˆ¶ã€‚

## æ ¸å¿ƒåŠŸèƒ½

- **æ¸¸æˆç©æ³•**ï¼šç»å…¸çš„ç‚¹å‡»äº¤æ¢æˆ–æ»‘åŠ¨äº¤æ¢æ¶ˆé™¤æ¨¡å¼ã€‚
- **åŠ¨æ€éš¾åº¦**ï¼šéšç€å…³å¡æå‡ï¼Œæ–¹å—ç§ç±»å¢åŠ ã€ç›®æ ‡åˆ†æ•°æé«˜ï¼ŒæŒ‘æˆ˜æ€§é€æ­¥å¢å¼ºã€‚
- **è¶…çº§æ–¹å—**ï¼šä½æ¦‚ç‡ç”Ÿæˆçš„ç‰¹æ®Šæ–¹å—ï¼Œæ¶ˆé™¤æ—¶å¯æ¸…é™¤æ•´è¡Œå’Œæ•´åˆ—ã€‚
- **è´¦æˆ·ç³»ç»Ÿ**ï¼šæ”¯æŒç©å®¶æ³¨å†Œä¸ç™»å½•ï¼Œæœ¬åœ° `localStorage` è‡ªåŠ¨ç™»å½•ã€‚
- **è¿›åº¦å­˜æ¡£**ï¼šå®æ—¶åŒæ­¥æ¸¸æˆå…³å¡å’Œæ€»å¾—åˆ†åˆ°äº‘ç«¯æ•°æ®åº“ã€‚
- **æ’è¡Œæ¦œ**ï¼šå±•ç¤ºå…¨çƒç©å®¶çš„é—¯å…³è¿›åº¦å’Œç´¯è®¡æœ€é«˜å¾—åˆ†ã€‚
- **ä¸ªäººè®¾ç½®**ï¼šæ”¯æŒä¿®æ”¹æ˜µç§°ã€å¯†ç ä»¥åŠå®‰å…¨é€€å‡ºã€‚
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é… PC ç«¯ä¸ç§»åŠ¨ç«¯è®¾å¤‡ã€‚

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**ï¼šHTML5, CSS3 (Flexbox, Grid, CSS Variables, Animations), Vanilla JavaScript (ES6+)ã€‚
- **åç«¯**ï¼šCloudflare Workers (Pages Functions)ã€‚
- **æ•°æ®åº“**ï¼šCloudflare D1 (SQLite-based SQL database)ã€‚

## é¡¹ç›®ç»“æ„

```text
d:/A_project_01/xiaoxiaole
â”œâ”€â”€ index.html              # æ¸¸æˆä¸»å…¥å£åŠ UI ç»“æ„
â”œâ”€â”€ style.css               # æ¸¸æˆè§†è§‰æ ·å¼åŠåŠ¨ç”»å®šä¹‰
â”œâ”€â”€ script.js               # æ ¸å¿ƒæ¸¸æˆé€»è¾‘åŠ API é€šä¿¡
â”œâ”€â”€ schema.sql              # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ functions/              # Cloudflare Workers API é€»è¾‘
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ login.js        # ç™»å½•å¤„ç†
â”‚       â”œâ”€â”€ register.js     # æ³¨å†Œå¤„ç†
â”‚       â”œâ”€â”€ rank.js         # æ’è¡Œæ¦œè·å–
â”‚       â”œâ”€â”€ save_progress.js # è¿›åº¦ä¿å­˜
â”‚       â””â”€â”€ update_profile.js# ç”¨æˆ·èµ„æ–™æ›´æ–°
â””â”€â”€ _redirects              # Cloudflare Pages è·¯ç”±é‡å®šå‘é…ç½®
```

## æ•°æ®åº“è®¾è®¡

é¡¹ç›®ä½¿ç”¨ä¸¤å¼ ä¸»è¦è¡¨ï¼š
1. `users`: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åã€åŠ å¯†åçš„å¯†ç ã€åˆ›å»ºæ—¶é—´ï¼‰ã€‚
2. `user_progress`: å­˜å‚¨ç©å®¶çš„æ¸¸æˆè¿›åº¦ï¼ˆå…³å¡ã€ç´¯è®¡å¾—åˆ†ã€æ›´æ–°æ—¶é—´ï¼‰ã€‚

## ç¯å¢ƒæ­å»ºä¸éƒ¨ç½²

æœ¬é¡¹ç›®åŸºäº Cloudflare å…¨å®¶æ¡¶ï¼ˆPages + Workers + D1ï¼‰å¼€å‘ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†çš„éƒ¨ç½²ä¸æœ¬åœ°å¼€å‘æ­¥éª¤ã€‚

### 1. ç¯å¢ƒå‡†å¤‡
- å®‰è£… [Node.js](https://nodejs.org/) (æ¨è LTS ç‰ˆæœ¬)ã€‚
- æ³¨å†Œä¸€ä¸ª [Cloudflare](https://dash.cloudflare.com/) è´¦å·ã€‚
- å®‰è£… Cloudflare CLI å·¥å…· Wranglerï¼š
  ```bash
  npm install -g wrangler
  ```

### 2. åˆ›å»ºå¹¶é…ç½® D1 æ•°æ®åº“
1. åœ¨ Cloudflare æ§åˆ¶å°åˆ›å»º D1 æ•°æ®åº“ï¼Œæˆ–ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºï¼š
   ```bash
   npx wrangler d1 create xiaoxiaole-db
   ```
2. **æœ¬åœ°å¼€å‘ç»‘å®š**ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `wrangler.toml` (å¦‚æœä½¿ç”¨ Pages åˆ™åœ¨æ§åˆ¶å°é…ç½®)ï¼Œç¡®ä¿ API èƒ½å¤Ÿè®¿é—®æ•°æ®åº“ã€‚
3. **åˆå§‹åŒ–è¡¨ç»“æ„**ï¼š
   ```bash
   # æœ¬åœ°ç¯å¢ƒåˆå§‹åŒ–
   npx wrangler d1 execute xiaoxiaole-db --local --file=./schema.sql
   
   # çº¿ä¸Šç¯å¢ƒåˆå§‹åŒ–
   npx wrangler d1 execute xiaoxiaole-db --remote --file=./schema.sql
   ```

### 3. æœ¬åœ°å¼€å‘è°ƒè¯•
1. **å¯åŠ¨é¢„è§ˆæœåŠ¡å™¨**ï¼š
   Cloudflare Pages æ”¯æŒæœ¬åœ°æ¨¡æ‹Ÿ Workers å’Œ D1ï¼š
   ```bash
   npx wrangler pages dev . --d1 xiaoxiaole-db
   ```
2. è®¿é—® `http://localhost:8788` å³å¯åœ¨æœ¬åœ°è¿›è¡Œæ¸¸æˆå¼€å‘å’Œæ¥å£è°ƒè¯•ã€‚

### 4. çº¿ä¸Šéƒ¨ç½²
1. **å…³è” GitHub (æ¨è)**ï¼š
   - å°†ä»£ç æ¨é€åˆ° GitHub ä»“åº“ã€‚
   - åœ¨ Cloudflare Pages åå°æ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹©è¯¥ä»“åº“ã€‚
   - åœ¨â€œè®¾ç½®â€ -> â€œå‡½æ•°â€ -> â€œD1 æ•°æ®åº“ç»‘å®šâ€ä¸­ï¼Œæ·»åŠ ç»‘å®šï¼š
     - **å˜é‡åç§°**: `xiaoxiaole` (å¿…é¡»ä¸ä»£ç ä¸­çš„ç»‘å®šå˜é‡ä¸€è‡´)
     - **D1 æ•°æ®åº“**: é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ `xiaoxiaole-db`
2. **å‘½ä»¤è¡Œéƒ¨ç½² (å¯é€‰)**ï¼š
   ```bash
   npx wrangler pages deploy . --project-name xiaoxiaole
   ```

## D1 æ•°æ®åº“ç®¡ç†ç»´æŠ¤

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦ç›´æ¥æ“ä½œæ•°æ®åº“ï¼ˆå¦‚åˆ é™¤ç”¨æˆ·ã€é‡ç½®è¿›åº¦ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `wrangler` å‘½ä»¤è¡Œå·¥å…·ã€‚

### å¸¸ç”¨ç®¡ç†å‘½ä»¤

> è¯·å°† `<database-name>` æ›¿æ¢ä¸ºä½ å®é™…çš„ D1 æ•°æ®åº“åç§°ã€‚

- **åˆ é™¤ç‰¹å®šç”¨æˆ·**ï¼š
  ```bash
  # åˆ é™¤ç”¨æˆ·è´¦å·åŠå…¶è¿›åº¦
  npx wrangler d1 execute xiaoxiaole --command="DELETE FROM users WHERE username = 'ç©å®¶æ˜µç§°';"
  npx wrangler d1 execute xiaoxiaole --command="DELETE FROM user_progress WHERE username = 'ç©å®¶æ˜µç§°';"
  ```

- **é‡ç½®æ‰€æœ‰ç©å®¶è¿›åº¦**ï¼š
  ```bash
  # å°†æ‰€æœ‰ç©å®¶çš„å…³å¡é‡ç½®ä¸º1ï¼Œå¾—åˆ†é‡ç½®ä¸º0
  npx wrangler d1 execute xiaoxiaole --command="UPDATE user_progress SET level = 1, total_score = 0;"
  ```

- **æ¸…ç©ºæ’è¡Œæ¦œï¼ˆæ¸…ç©ºæ‰€æœ‰è¿›åº¦æ•°æ®ï¼‰**ï¼š
  ```bash
  npx wrangler d1 execute xiaoxiaole --command="DELETE FROM user_progress;"
  ```

- **æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆå±é™©æ“ä½œï¼‰**ï¼š
  ```bash
  npx wrangler d1 execute xiaoxiaole --command="DELETE FROM user_progress; DELETE FROM users;"
  ```

- **æŸ¥è¯¢å½“å‰æ³¨å†Œç”¨æˆ·æ•°**ï¼š
  ```bash
  npx wrangler d1 execute xiaoxiaole --command="SELECT COUNT(*) FROM users;"
  ```

- **æŸ¥çœ‹æ’è¡Œæ¦œæ•°æ®**ï¼š
  ```bash
  npx wrangler d1 execute xiaoxiaole --command="SELECT username, level, total_score FROM user_progress ORDER BY level DESC, total_score DESC LIMIT 10;"
  ```

## æ¸¸æˆè§„åˆ™

1. **åŸºç¡€æ¶ˆé™¤**ï¼šå°†ä¸‰ä¸ªæˆ–æ›´å¤šç›¸åŒçš„æ–¹å—è¿æˆä¸€çº¿å³å¯æ¶ˆé™¤ã€‚
2. **è¶…çº§æ–¹å—**ï¼šå¸¦æœ‰ `ğŸŒŸ` æ ‡è¯†çš„æ–¹å—ï¼Œå‚ä¸æ¶ˆé™¤æ—¶ä¼šå¼•å‘åå­—å½¢å¤§èŒƒå›´çˆ†ç‚¸ã€‚
3. **è¿‡å…³æ¡ä»¶**ï¼šåœ¨è§„å®šçš„æ­¥æ•°å†…è¾¾åˆ°ç›®æ ‡åˆ†æ•°ã€‚
4. **æ­»å±€å¤„ç†**ï¼šå½“æ£‹ç›˜ä¸Šæ²¡æœ‰å¯æ¶ˆé™¤çš„ç»„åˆæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ´—ç‰Œã€‚

---
*ç¥ä½ ç©å¾—å¼€å¿ƒï¼*
